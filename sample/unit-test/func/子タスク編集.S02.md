# 子タスク編集(S02) 単体テストケース一覧

## 1. 正常系テストケース

### S02-C1001
- 正常系
- テスト観点
    - 認証トークン検証が正常に通ること
    - 子タスク存在確認・親タスク所有者確認が正常に通ること
    - 入力バリデーション（タイトル・詳細）が正常に通ること
    - 子タスク更新が正常に実行されること
    - レスポンスのステータスコードが200であること
    - 更新された子タスク情報が返却されること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "更新されたタスクタイトル", "description": "更新されたタスクの詳細"}
- 期待値
    - HTTPステータス: 200
    - ログメッセージ: I-S0002
    - レスポンスボディ: {"child_task_id": 1, "parent_task_id": 1, "title": "更新されたタスクタイトル", "description": "更新されたタスクの詳細", "status": 0, "updated_at": "2024-01-01T10:00:00Z"}

### S02-C1002
- 正常系
- テスト観点
    - 詳細欄が空文字列の場合でも正常に更新されること
    - レスポンスのステータスコードが200であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "タイトルのみ更新", "description": ""}
- 期待値
    - HTTPステータス: 200
    - ログメッセージ: I-S0002
    - レスポンスボディ: {"child_task_id": 1, "parent_task_id": 1, "title": "タイトルのみ更新", "description": null, "status": 0, "updated_at": "2024-01-01T10:00:00Z"}

## 2. 異常系テストケース（認証エラー）

### S02-E2001
- 異常系
    - 認証トークン未提供
- テスト観点
    - 認証トークンが提供されていない場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0009」が出力されること
    - レスポンスのステータスコードが401であること
- 入力値
    - HTTPヘッダー: Authorization: （未設定）
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "更新タイトル", "description": "更新詳細"}
- 期待値
    - HTTPステータス: 401
    - ログメッセージ: E-S0009

### S02-E2002
- 異常系
    - 無効な認証トークン
- テスト観点
    - 無効な認証トークンでバリデーションエラーが発生すること
    - エラーメッセージ「E-S0010」が出力されること
    - レスポンスのステータスコードが401であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer invalid_token
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "更新タイトル", "description": "更新詳細"}
- 期待値
    - HTTPステータス: 401
    - ログメッセージ: E-S0010

## 3. 異常系テストケース（子タスク・親タスク所有者確認エラー）

### S02-E3001
- 異常系
    - 存在しない子タスクID
- テスト観点
    - 存在しない子タスクIDでエラーが発生すること
    - エラーメッセージ「E-S0012」が出力されること
    - レスポンスのステータスコードが404であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 999999
    - リクエストボディ: {"title": "更新タイトル", "description": "更新詳細"}
- 期待値
    - HTTPステータス: 404
    - ログメッセージ: E-S0012

### S02-E3002
- 異常系
    - 他ユーザの子タスクに対する編集権限なし
- テスト観点
    - 他ユーザが所有する親タスクの子タスクを編集しようとした場合にエラーが発生すること
    - エラーメッセージ「E-S0012」が出力されること
    - レスポンスのステータスコードが404であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [UserAのJWTトークン]
    - URLパラメータ: child_task_id: [UserBの子タスクID]
    - リクエストボディ: {"title": "更新タイトル", "description": "更新詳細"}
- 期待値
    - HTTPステータス: 404
    - ログメッセージ: E-S0012

### S02-E3003
- 異常系
    - DB接続エラー（子タスク存在確認時）
- テスト観点
    - 子タスク存在確認時のDB接続エラーでエラーが発生すること
    - エラーメッセージ「E-S0011」が出力されること
    - レスポンスのステータスコードが500であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "更新タイトル", "description": "更新詳細"}
- 期待値
    - HTTPステータス: 500
    - ログメッセージ: E-S0011
- 備考
    - DB接続を強制的に切断する等のテスト環境での設定が必要

## 4. 異常系テストケース（入力バリデーションエラー）

### S02-E4001
- 異常系
    - タイトルが空文字列
- テスト観点
    - タイトルが空文字列の場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0013」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "", "description": "詳細"}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0013

### S02-E4002
- 異常系
    - タイトルが文字列でない
- テスト観点
    - タイトルが文字列以外の場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0013」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": 123, "description": "詳細"}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0013

### S02-E4003
- 異常系
    - タイトルが256文字以上
- テスト観点
    - タイトルが255文字を超える場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0013」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "[256文字の文字列]", "description": "詳細"}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0013

### S02-E4004
- 異常系
    - 詳細が文字列でない
- テスト観点
    - 詳細が文字列以外の場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0014」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "タイトル", "description": 123}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0014

### S02-E4005
- 異常系
    - 詳細が65536文字以上
- テスト観点
    - 詳細が65535文字を超える場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0014」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "タイトル", "description": "[65536文字の文字列]"}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0014

## 5. 異常系テストケース（DB更新エラー）

### S02-E5001
- 異常系
    - DB接続エラー（更新時）
- テスト観点
    - 子タスク更新時のDB接続エラーでエラーが発生すること
    - エラーメッセージ「E-S0015」が出力されること
    - レスポンスのステータスコードが500であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "更新タイトル", "description": "更新詳細"}
- 期待値
    - HTTPステータス: 500
    - ログメッセージ: E-S0015
- 備考
    - DB接続を強制的に切断する等のテスト環境での設定が必要

### S02-E5002
- 異常系
    - DB更新失敗
- テスト観点
    - 子タスク更新処理が失敗した場合にエラーが発生すること
    - エラーメッセージ「E-S0016」が出力されること
    - レスポンスのステータスコードが500であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"title": "更新タイトル", "description": "更新詳細"}
- 期待値
    - HTTPステータス: 500
    - ログメッセージ: E-S0016
- 備考
    - テーブルロックや制約違反を発生させる等のテスト環境での設定が必要