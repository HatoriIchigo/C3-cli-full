# 子タスク状態変更(S03) 単体テストケース一覧

## 1. 正常系テストケース

### S03-C1001
- 正常系
- テスト観点
    - 認証トークン検証が正常に通ること
    - 子タスク存在確認・親タスク所有者確認が正常に通ること
    - ステータスバリデーションが正常に通ること
    - 子タスクステータス更新が正常に実行されること
    - レスポンスのステータスコードが200であること
    - 更新された子タスク情報が返却されること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 200
    - ログメッセージ: I-S0003
    - レスポンスボディ: {"child_task_id": 1, "parent_task_id": 1, "title": "子タスクタイトル", "description": "子タスク詳細", "status": "completed", "updated_at": "2024-01-01T10:00:00Z"}

### S03-C1002
- 正常系
- テスト観点
    - ステータスを'pending'に変更できること
    - レスポンスのステータスコードが200であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "pending"}
- 期待値
    - HTTPステータス: 200
    - ログメッセージ: I-S0003
    - レスポンスボディ: {"child_task_id": 1, "parent_task_id": 1, "title": "子タスクタイトル", "description": "子タスク詳細", "status": "pending", "updated_at": "2024-01-01T10:00:00Z"}

## 2. 異常系テストケース（認証エラー）

### S03-E2001
- 異常系
    - 認証トークン未提供
- テスト観点
    - 認証トークンが提供されていない場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0017」が出力されること
    - レスポンスのステータスコードが401であること
- 入力値
    - HTTPヘッダー: Authorization: （未設定）
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 401
    - ログメッセージ: E-S0017

### S03-E2002
- 異常系
    - 無効な認証トークン
- テスト観点
    - 無効な認証トークンでバリデーションエラーが発生すること
    - エラーメッセージ「E-S0018」が出力されること
    - レスポンスのステータスコードが401であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer invalid_token
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 401
    - ログメッセージ: E-S0018

## 3. 異常系テストケース（子タスク・親タスク所有者確認エラー）

### S03-E3001
- 異常系
    - 存在しない子タスクID
- テスト観点
    - 存在しない子タスクIDでエラーが発生すること
    - エラーメッセージ「E-S0020」が出力されること
    - レスポンスのステータスコードが404であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 999999
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 404
    - ログメッセージ: E-S0020

### S03-E3002
- 異常系
    - 他ユーザの子タスクに対する状態変更権限なし
- テスト観点
    - 他ユーザが所有する親タスクの子タスクの状態を変更しようとした場合にエラーが発生すること
    - エラーメッセージ「E-S0020」が出力されること
    - レスポンスのステータスコードが404であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [UserAのJWTトークン]
    - URLパラメータ: child_task_id: [UserBの子タスクID]
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 404
    - ログメッセージ: E-S0020

### S03-E3003
- 異常系
    - DB接続エラー（子タスク存在確認時）
- テスト観点
    - 子タスク存在確認時のDB接続エラーでエラーが発生すること
    - エラーメッセージ「E-S0019」が出力されること
    - レスポンスのステータスコードが500であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 500
    - ログメッセージ: E-S0019
- 備考
    - DB接続を強制的に切断する等のテスト環境での設定が必要

## 4. 異常系テストケース（ステータスバリデーションエラー）

### S03-E4001
- 異常系
    - ステータスが文字列でない
- テスト観点
    - ステータスが文字列以外の場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0021」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": 123}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0021

### S03-E4002
- 異常系
    - ステータスが不正な値
- テスト観点
    - ステータスが'pending'または'completed'以外の場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0021」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "invalid_status"}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0021

### S03-E4003
- 異常系
    - ステータスが空文字列
- テスト観点
    - ステータスが空文字列の場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0021」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": ""}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0021

### S03-E4004
- 異常系
    - ステータスフィールドが未設定
- テスト観点
    - リクエストボディにstatusフィールドが含まれていない場合にバリデーションエラーが発生すること
    - エラーメッセージ「E-S0021」が出力されること
    - レスポンスのステータスコードが400であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {}
- 期待値
    - HTTPステータス: 400
    - ログメッセージ: E-S0021

## 5. 異常系テストケース（DB更新エラー）

### S03-E5001
- 異常系
    - DB接続エラー（更新時）
- テスト観点
    - 子タスクステータス更新時のDB接続エラーでエラーが発生すること
    - エラーメッセージ「E-S0022」が出力されること
    - レスポンスのステータスコードが500であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 500
    - ログメッセージ: E-S0022
- 備考
    - DB接続を強制的に切断する等のテスト環境での設定が必要

### S03-E5002
- 異常系
    - DB更新失敗
- テスト観点
    - 子タスクステータス更新処理が失敗した場合にエラーが発生すること
    - エラーメッセージ「E-S0023」が出力されること
    - レスポンスのステータスコードが500であること
- 入力値
    - HTTPヘッダー: Authorization: Bearer [有効なJWTトークン]
    - URLパラメータ: child_task_id: 1
    - リクエストボディ: {"status": "completed"}
- 期待値
    - HTTPステータス: 500
    - ログメッセージ: E-S0023
- 備考
    - テーブルロックや制約違反を発生させる等のテスト環境での設定が必要