# 郵便番号検索API 住所検索 実装書

## 基本情報
- **接続先**: `zipcloud.ibsnet.co.jp/api/search`
- **メソッド**: GET
- **プロトコル**: HTTPS
- **リクエストパラメータ**:
    - `zipcode` (string, 必須): 郵便番号（7桁、ハイフン付きも可）
    - `limit` (number, 任意): 最大件数（デフォルト：20）
    - `callback` (string, 任意): JSONP用コールバック関数名
- **リクエスト**:
    - **ソース**: `@src/schema/external/ZipcloudAddressSearchRequest.py`
    - **ドキュメント**: `docs/impl/external/schema/郵便番号検索_住所検索_リクエスト.md`
- **レスポンス**:
    - **ソース**: `@src/schema/external/ZipcloudAddressSearchResponse.py`
    - **ドキュメント**: `docs/impl/external/schema/郵便番号検索_住所検索_レスポンス.md`

## 実装時のメソッド
- **メソッド名**: `searchAddressByZipcode`
- **引数**:
    - zipcode (string): 郵便番号
    - limit (number, 任意): 最大件数（デフォルト：20）
- **戻り値**: string (住所文字列：都道府県 + 市区町村 + 町域)

## 処理フロー
1. バリデーション処理
    - 郵便番号バリデーション: `validation.validateZipCode`
        - `zipCode=zipcode`、`required=True`
    - 参照
        - ソース: `@src/validation.py`
        - ドキュメント: `@docs/impl/validation.md`
2. リクエストスキーマに代入
3. URL構築
4. APIリクエスト（GET）
5. レスポンススキーマからstatusを確認
    - status != 200の場合、messageを含むExceptionを発生
6. レスポンススキーマから`results[0]`を取得
7. `address1` + `address2` + `address3` を文字列として結合し、returnする

## 実装上の注意事項

### エラーハンドリング
- HTTPステータスコードは常に200だが、レスポンス内のstatusフィールドでエラーを判定
- status=400: 入力パラメータエラー
- status=500: API内部エラー

### タイムアウト設定
- 推奨タイムアウト: 5秒
- リトライ回数: 最大3回（指数バックオフ）

### レート制限
- 明確な制限値は不明だが、過度なリクエストは避ける
- アプリケーション側で適切な間隔を設ける（推奨：1秒間隔以上）

### データ形式の注意
- 郵便番号: ハイフンありでも受け付けるが、レスポンスは7桁数字のみ
- カナ文字: 半角カタカナ
- 都道府県コード: 文字列形式（数値ではない）